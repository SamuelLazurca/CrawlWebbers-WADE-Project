@prefix davi-nist: <https://purl.org/davi/vocab/nist#> .
@prefix davi-meta: <https://purl.org/davi/vocab/meta#> .
@prefix owl:       <http://www.w3.org/2002/07/owl#> .
@prefix rdf:       <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:      <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms:   <http://purl.org/dc/terms/> .
@prefix skos:      <http://www.w3.org/2004/02/skos/core#> .
@prefix schema:    <http://schema.org/> .
@prefix xsd:       <http://www.w3.org/2001/XMLSchema#> .

# --- ONTOLOGY METADATA ---
davi-nist:NISTVulnerabilityOntology a owl:Ontology ;
    rdfs:label "DaVi NIST Security Extensions"@en ;
    dcterms:description "Domain ontology for NIST NVD (CVE, CWE, CPE, Organization), mapped to DaVi visualization engine."@en ;
    owl:imports <http://schema.org/> .

# ==========================================
# 1. CORE CONCEPTS (ENTITIES)
# ==========================================

davi-nist:Vulnerability a owl:Class, davi-meta:Concept ;
    rdfs:label "Vulnerability (CVE)"@en ;
    davi-meta:uiLabel "Vulnerabilities" ;
    davi-meta:icon "bug" ;
    dcterms:description "A weakness in the computational logic found in software/hardware."@en .

davi-nist:Weakness a owl:Class, davi-meta:Concept ;
    rdfs:label "Weakness (CWE)"@en ;
    davi-meta:uiLabel "Weakness Types" ;
    davi-meta:icon "shield-alert" ;
    rdfs:subClassOf skos:Concept .

schema:SoftwareApplication a owl:Class, davi-meta:Concept ;
    rdfs:label "Software Product (CPE)"@en ;
    davi-meta:uiLabel "Software Products" ;
    davi-meta:icon "monitor" .

schema:Organization a owl:Class, davi-meta:Concept ;
    rdfs:label "Vendor / Organization"@en ;
    davi-meta:uiLabel "Vendors" ;
    davi-meta:icon "business" .

davi-nist:CVSSMetric a owl:Class, davi-meta:Concept ;
    rdfs:label "CVSS Metric Info"@en ;
    davi-meta:uiLabel "CVSS Scoring Details" .

# ==========================================
# 2. DIMENSIONS (Visualizable Attributes)
# ==========================================

# --- TEMPORAL DIMENSIONS ---
schema:datePublished a owl:DatatypeProperty ;
    rdfs:label "Published Date"@en ;
    rdfs:domain davi-nist:Vulnerability ;
    davi-meta:isDimension "true"^^xsd:boolean ;
    davi-meta:uiLabel "Publication Date" ;
    davi-meta:visualizationType "Temporal" ;
    davi-meta:dateFormat "YYYY-MM-DD" .

schema:dateModified a owl:DatatypeProperty ;
    rdfs:label "Modified Date"@en ;
    rdfs:domain davi-nist:Vulnerability ;
    davi-meta:isDimension "true"^^xsd:boolean ;
    davi-meta:uiLabel "Last Modified" ;
    davi-meta:visualizationType "Temporal" .

# --- CATEGORICAL DIMENSIONS ---

# LINK: Software -> Organization (Vendor)
# Updated to owl:ObjectProperty because 'vendor:acquia' is a URI, not a string
schema:manufacturer a owl:ObjectProperty ;
    rdfs:label "Vendor Link"@en ;
    rdfs:domain schema:SoftwareApplication ;
    rdfs:range schema:Organization ;
    davi-meta:isDimension "true"^^xsd:boolean ;
    davi-meta:uiLabel "Vendor" ;
    davi-meta:visualizationType "Categorical" .

# Vulnerability -> (Software) -> Organization
# Allows "Vulnerabilities by Vendor" without complex UI logic
davi-nist:affectsVendor a owl:ObjectProperty ;
    rdfs:label "Inferred Vendor"@en ;
    rdfs:domain davi-nist:Vulnerability ;
    rdfs:range schema:Organization ;
    davi-meta:isDimension "true"^^xsd:boolean ;
    davi-meta:uiLabel "Affected Vendor" ;
    owl:propertyChainAxiom ( davi-nist:affectsSoftware schema:manufacturer ) .

schema:softwareVersion a owl:DatatypeProperty ;
    rdfs:label "Version"@en ;
    rdfs:domain schema:SoftwareApplication ;
    davi-meta:isDimension "true"^^xsd:boolean ;
    davi-meta:uiLabel "Software Version" ;
    davi-meta:visualizationType "Categorical" .

skos:prefLabel a owl:DatatypeProperty ;
    rdfs:label "Weakness Name"@en ;
    rdfs:domain davi-nist:Weakness ;
    davi-meta:isDimension "true"^^xsd:boolean ;
    davi-meta:uiLabel "Weakness Name" ;
    davi-meta:visualizationType "Categorical" .

davi-nist:vectorString a owl:DatatypeProperty ;
    rdfs:label "CVSS Vector"@en ;
    rdfs:domain davi-nist:CVSSMetric ;
    rdfs:range xsd:string ;
    davi-meta:isDimension "true"^^xsd:boolean ;
    davi-meta:uiLabel "Attack Vector" ;
    davi-meta:visualizationType "Categorical" .

dcterms:conformsTo a owl:ObjectProperty ;
    rdfs:label "CVSS Standard"@en ;
    rdfs:domain davi-nist:CVSSMetric ;
    davi-meta:isDimension "true"^^xsd:boolean ;
    davi-meta:uiLabel "CVSS Version" ;
    davi-meta:visualizationType "Categorical" .

# --- TEXT DIMENSIONS ---

# NEW: The label for the Vendor Organization
schema:name a owl:DatatypeProperty ;
    rdfs:label "Name"@en ;
    rdfs:domain schema:Organization ;
    davi-meta:isDimension "true"^^xsd:boolean ;
    davi-meta:uiLabel "Name" ;
    davi-meta:visualizationType "Text" .

schema:description a owl:DatatypeProperty ;
    rdfs:label "Description"@en ;
    davi-meta:isDimension "true"^^xsd:boolean ;
    davi-meta:uiLabel "Description" ;
    davi-meta:visualizationType "Text" .

davi-nist:cpe23 a owl:DatatypeProperty ;
    rdfs:label "CPE 2.3 String"@en ;
    rdfs:domain schema:SoftwareApplication ;
    davi-meta:isDimension "true"^^xsd:boolean ;
    davi-meta:uiLabel "CPE Identifier" ;
    davi-meta:visualizationType "Text" .

# ==========================================
# 3. METRICS (Aggregatable Numbers)
# ==========================================

davi-nist:baseScore a owl:DatatypeProperty ;
    rdfs:label "CVSS Base Score"@en ;
    rdfs:domain davi-nist:CVSSMetric ;
    rdfs:range xsd:decimal ;
    davi-meta:isMetric "true"^^xsd:boolean ;
    davi-meta:uiLabel "Severity Score (0-10)" ;
    davi-meta:defaultAggregation "AVG" ;
    davi-meta:allowedAggregations "AVG", "MAX", "MIN", "COUNT" .

# ==========================================
# 4. RELATIONSHIPS (Navigation)
# ==========================================

# Vulnerability -> Software
davi-nist:affectsSoftware a owl:ObjectProperty ;
    rdfs:label "Affects Software"@en ;
    rdfs:domain davi-nist:Vulnerability ;
    rdfs:range schema:SoftwareApplication .

# Vulnerability -> Weakness
davi-nist:hasWeakness a owl:ObjectProperty ;
    rdfs:label "Has Weakness"@en ;
    rdfs:domain davi-nist:Vulnerability ;
    rdfs:range davi-nist:Weakness ;
    owl:inverseOf davi-nist:isWeaknessOf .

davi-nist:isWeaknessOf a owl:ObjectProperty ;
    rdfs:label "Is Weakness Of"@en ;
    rdfs:domain davi-nist:Weakness ;
    rdfs:range davi-nist:Vulnerability .

# Vulnerability -> Metric
davi-nist:hasCVSSMetric a owl:ObjectProperty ;
    rdfs:label "Has Metric"@en ;
    rdfs:domain davi-nist:Vulnerability ;
    rdfs:range davi-nist:CVSSMetric .

# Weakness Hierarchy (Parent/Child)
skos:broader a owl:ObjectProperty ;
    rdfs:label "Broader Weakness"@en ;
    rdfs:domain davi-nist:Weakness ;
    rdfs:range davi-nist:Weakness .

skos:narrower a owl:ObjectProperty ;
    rdfs:label "Narrower Weakness"@en ;
    rdfs:domain davi-nist:Weakness ;
    rdfs:range davi-nist:Weakness .
